<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<title>EMIT</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
<link rel="stylesheet" href="./css/font-awesome.min.css">
<link href="css/sb-admin-2.css" rel="stylesheet">
</head>

<script type="text/javascript" src="DJS/Chart.min.js"></script>
<script type="text/javascript"
	src="https://code.jquery.com/jquery-3.1.1.min.js"></script>
<script type="text/javascript"
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<script type="text/javascript"
	src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.2/angular.min.js"></script>
<script type="text/javascript" src="DJS/angular-chart.min.js"></script>

<script type="text/javascript" src="DJS/sb-admin-2.js"></script>

<script type="text/javascript">
	var app = angular.module('app', [ 'chart.js' ]);
	// tableau de navigation des items et ses variables	
	var tree = [];

	app.controller('myCtrl', function($scope, $http, $q) {

		$scope.loaded_file = "- None -";
		$scope.retrive_instrument_name = function(uri) {
			var name = "";
			angular.forEach($scope.instrumentlist, function(value) {//$scope.measurandlist
				if (uri == value.uri) {
					name = value.name;
				}
			});
			return name;
		}

		$scope.fill_measurement = function(key) {
			console.log(key);
			$scope.measurementlist = [];

			$http.get("http://172.21.50.3:8080/emit/measurement/list", {
				"params" : {
					"fkey" : key
				}
			}).then(function(success) {
				$scope.measurementlist = success.data;

				console.log(angular.toJson(success.data));
				console.log(angular.toJson($scope.measurementlist));
			}, function(error) {
				$scope.measurementlist = [];

			});
		}

		$scope.fill_measurementset = function(key) {
			var i = 0;
			$scope.measurementlist = [];
			$scope.measurementsetlist = [];
			console.log("je suis bien actif");
			console.log(key);
			$http.get("http://172.21.50.3:8080/emit/measurementSet/list", {
				"params" : {
					"fkey" : key
				}
			}).then(
					function(success) {
						var measurementset = success.data;
						angular.forEach(measurementset, function(value) {
							$scope.measurementsetlist[i] = value;
							$scope.measurementsetlist[i].name = $scope
									.retrive_instrument_name(value.instrument);
							i++;
						});
						console.log(angular.toJson($scope.measurementsetlist));
						console.log(success.data);
					}, function(error) {
						$scope.measurementsetlist = [];

					});

		}

		$scope.fill_experiment = function(key) {
			$scope.measurementsetlist = [];
			$scope.measurementlist = [];
			$http.get("http://172.21.50.3:8080/emit/experiment/list", {
				"params" : {
					"fkey" : key
				}
			}).then(function(success) {
				$scope.experimentlist = success.data;
			}, function(error) {
				$scope.environments = [];
			});
		}

		$scope.refresh = function() {
			// déclaration des promesses (voir promises)
			var experiment = $http
					.get("http://172.21.50.3:8080/emit/experiment/list");
			var instrument = $http
					.get("http://172.21.50.3:8080/emit/instrument/list");
			var environment = $http
					.get("http://172.21.50.3:8080/emit/environment/list");
			var measure = $http
					.get("http://172.21.50.3:8080/emit/measure/list");
			var measurement = $http
					.get("http://172.21.50.3:8080/emit/measurement/list");
			var measurand = $http
					.get("http://172.21.50.3:8080/emit/measurand/list");
			var measurementset = $http
					.get("http://172.21.50.3:8080/emit/measurementSet/list");

			// attente de la réalisation de toutes les promesses
			$q.all(
					[ experiment, instrument, environment, measure,
							measurement, measurand, measurementset ]).then(
					function(values) {
						//console.log(angular.toJson(values[0].data))
						$scope.experimentlist = values[0].data;
						$scope.instrumentlist = values[1].data;
						$scope.environmentlist = values[2].data;
						$scope.measurelist = values[3].data;
						$scope.measurementlist = values[4].data;
						$scope.measurandlist = values[5].data;
						$scope.measurementsetlist = values[6].data;
						//réalisation des opérations souaitées

					});

		}

		$scope.refresh();

		$scope.afficher_test = function(file_name) {
			var retour_test = [];
			var serie = [];
			var serie1 = [];
			var globalSerie = [];

			$http.get(
					"http://172.21.50.3:8080/emit/test/test?file_name="
							+ file_name).then(function(response) {
				retour_test = response.data;
				//console.log(retour_test.length);

				for (var i = 0; i < retour_test.length; i++) {

					serie[i] = retour_test[i].x / 1000;
					serie1[i] = retour_test[i];

					console.log(i);
					// renvois
				}

				$scope.loaded_file = "Loaded file : " + file_name;
				console.log(angular.toJson(serie1));
				globalSerie.push(serie1);

				$scope.labels = serie
				$scope.series = [ 'Series A' ];

				console.log(serie);

				$scope.data = globalSerie;
				$scope.onClick = function(points, evt) {
					console.log(points, evt);

				}
			});
		}
		$scope.launchexp = function() {
			alert('lancer experiment');
		}
		$scope.launchmeas = function() {
			alert('lancer creation measurementset');
		}

	});
</script>
<body ng-app="app" ng-controller="myCtrl">
	<header>
		<div class="navbar navbar-default navbar-custom navbar-static-top"
			id="navigation_barre">
			<div class="container">
				<a href="./index.html" class="navbar-brand" id="titre_appli">EMIT</a>
				<ul id="menu">
					<li class="active primaire"><a href="./index.html"
						class="primaire"><span class="glyphicon glyphicon-home">&ensp;</span>
							Home</a></li>

					<li class="dropdown primaire"><a href="#"
						class="dropdown-toggle primaire" data-toggle="dropdown"
						role="button" aria-expanded="false"><span
							class="glyphicon glyphicon-pushpin">&ensp;</span> Elements<span
							class="caret"></span></a>
						<ul class="dropdown-menu">
							<li><a href="./Instrument.html">Instruments</a></li>
							<li><a href="./Environment.html">Environments</a></li>
							<li><a href="./Measurand.html">Measurands</a></li>
							<li><a href="./Measure.html">Measures</a></li>
						</ul></li>
					<li class="active primaire"><a href="./CreateExperiment.html"
						class="primaire"><span class="glyphicon glyphicon-plus">&ensp;</span>Add
							experiment</a></li>
					<li class="active primaire"><a href="./test.html"
						class="primaire"><span class="glyphicon glyphicon-dashboard">&ensp;</span>
							Test</a></li>
				</ul>
			</div>
		</div>
	</header>
	<div id = "content" class="container">
		<section class="col-md-4">
			<div class="form-group">
			<legend>Load a file : </legend>
				<div id="acordion" class="sidebar-nav navbar-collapse">
					<b>Measurand selection :</b>
					<ul class="nav scrollLites" id="side-menu">
						<li ng-repeat="x in measurandlist"><a
							ng-click="fill_experiment(x.process)">{{x.name}}</a></li>
					</ul>
					<b>Experiment selection :</b>
					<ul class="nav scrollLites" id="side-menu">
						<li ng-repeat="x in experimentlist"><a
							ng-click="fill_measurementset(x.id)">{{x.started |
								date:"MM/dd/yyyy 'at' h:mma"}}</a></li>
					</ul>
					<b>Measurementset selection :</b>
					<ul class="nav scrollLites" id="side-menu">
						<li ng-repeat="x in measurementsetlist"><a
							ng-click="fill_measurement(x.id)">{{x.name}}</a></li>
					</ul>
					<b>Measurement selection :</b>
					<ul class="nav scrollLites" id="side-menu">
						<li ng-repeat="x in measurementlist"><a
							ng-click="afficher_test(x.data)">{{x.measure}}</a></li>
					</ul>
				</div>
			</div>
		</section>
		<section class="col-md-8">
			<!-- <div id="page-wrapper">
				<div col-md-10> -->
			<div class="form-group">
				<legend>Quick launch : </legend>
				<button ng-click="launchexp()" class="btn btn">
					<span class="glyphicon glyphicon-expand">&ensp;</span> Launch an
					unprocessed experiment
				</button>
				<br>
				<button ng-click="launchmeas()" class="btn btn">
					<span class="glyphicon glyphicon-expand">&ensp;</span> Launch
					measurementSets creation
				</button>
			</div>
			<legend ng-model="loaded_file"> Loaded file : {{ loaded_file
				}} </legend>
			<canvas id="line" class="chart chart-line" chart-data="data"
				chart-labels="labels" chart-series="series" chart-options="options"
				chart-dataset-override="datasetOverride" chart-click="onClick">
			</canvas>
			<!-- </div>
			</div> -->
		</section>
	</div>
	<footer id = "footer">
        <div class="container">
          <div class="row">
            <div class="col-md-4">
            	<br>
              	<span class="text-left">Copyright © 2015-2017. ICAM. Tous droits réservés.</span>
            </div>
            <div class="col-md-4">
           		<a href="https://www.icam.fr/icam/les-campus-icam/icam-site-de-nantes" target="_blank"><img class="center-block" src="./png/icam.png" height="60" alt="Icam" /></a>
            </div>  
            <div class="col-md-4"> 
              <div class="text-right">
              <br>
                <a href="https://www.facebook.com/icam.nantes" target="_blank"><i class="fa fa-facebook-square fa-2x text-muted"></i></a>
                <span>&emsp;</span>
                <a href="https://twitter.com/icam_fr" target="_blank"><i class="fa fa-twitter fa-2x text-muted"></i></a>
                <span>&emsp;</span>
                <a href="https://plus.google.com/118426909654384683619/about" target="_blank"><i class="fa fa-google-plus fa-2x text-muted"></i></a>
                <span>&emsp;</span>
                <a href="https://www.linkedin.com/company/icam-institut-catholique-d%27arts-et-metiers" target="_blank"><i class="fa fa-linkedin fa-2x text-muted"></i></a>
                <span>&emsp;</span>
                <a href="https://www.youtube.com/channel/UCQbkQwnly-uMpHTdudW8ocw"  target="_blank"><i class="fa fa-youtube fa-2x text-muted"></i></a>
              </div>
            </div>
          </div>
        </div>
    </footer>
</body>

</html>
